---
title: "R Notebook"
output: html_notebook
---

Домашнее задание 4

Использование основных статистических тестов и поправок на множественные сравнения.

1. Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. 
Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатом (функция set.seed()). 
Задайте размер выборки sample_size <- 30. 
Задайте значение среднего артериального давления до приема нового препарата и после.

- Сформулируйте нулевую и альтернативную гипотезы.
- Определите уровень значимости.
- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
- Определите наблюдаемое значение статистики, а также критическое значение статистики.
- Оцените и прокомментируйте статистическую значимость.
```{r}
# Установим seed для воспроизводимости результатов
set.seed(123)

# Размер выборки
sample_size <- 30

# Значения среднего артериального давления до и после приема препарата
mean_before <- 140
mean_after <- 130

# Сгенерируем данные
data <- data.frame(
  id = 1:sample_size,
  pressure_before = rnorm(sample_size, mean = mean_before, sd = 15),
  pressure_after = rnorm(sample_size, mean = mean_after, sd = 15)
)

# Соберем датасет
dataset <- data.frame(
  id = data$id,
  pressure_before = data$pressure_before,
  pressure_after = data$pressure_after,
  improvement = data$pressure_before - data$pressure_after
)

# Создадим таблицу сопряженности
table_contingency <- table(dataset$pressure_before > mean_before, dataset$pressure_after > mean_after)
rownames(table_contingency) <- c("pressure_before > mean_before = FALSE", "pressure_before > mean_before = TRUE")
colnames(table_contingency) <- c("pressure_after > mean_after = FALSE", "pressure_after > mean_after = TRUE")

# Выводим сгенерированный датасет
print(dataset)

# Выводим таблицу сопряженности
print(table_contingency)
```

```{r}
# Нулевая и альтернативная гипотезы
#H0: mean_before <= mean_after # внедрение нового препарата в среднем не улучше снижает давление по сравнению со стандартной терапией
#Ha: mean_before > mean_after # внедрение нового препарата в среднем лучше снижает давление по сравнению со стандартной терапией

# Уровень значимости
alpha <- 0.05

# Выбираем статистический тест (парный t-тест для зависимых групп)
# Этот тест используется для сравнения средних значений в зависимых выборках (например, до и после лечения)
t_test <- t.test(data$pressure_before, data$pressure_after, paired = TRUE, alternative = "greater")

# Наблюдаемое значение статистики
t_obs <- t_test$statistic

# Критическое значение статистики
t_crit <- qt(alpha, df = sample_size - 1)

# Оцениваем статистическую значимость
p_value <- t_test$p.value
if (p_value < alpha) {
  cat("Статистически значимо (p-value =", p_value, ")")
} else {
  cat("Статистически не значимо (p-value =", p_value, ")")
}
```
Есть статистически значимые доказательства того, что внедрение нового препарата в среднем лучше снижает артериальное давление по сравнению со стандартной терапией для пациентов с артериальной гипертензией. Таким образом, результаты нашего исследования поддерживают альтернативную гипотезу.



2. Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких.
Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих – 0.2

Рассмотрите два случая: для выборки sample_size1 <- 100 и sample_size2 <- 30.
Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

- Сформулируйте нулевую и альтернативную гипотезы.
- Определите уровень значимости.
- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
- Определите наблюдаемое значение статистики, а также критическое значение статистики.
- Оцените и прокомментируйте статистическую значимость. (3 балла)

```{r}
# Загрузка необходимых библиотек
library(ggplot2)

# Установка seed для воспроизводимости
set.seed(123)

# Создание равного количества курящих и некурящих
num_smokers <- 0.8
num_nonsmokers <- 0.2

sample_size1 <- 100
sample_size2 <- 30


# Генерация случаев рака легких для курящих
lung_cancer_smokers1 <- rep(1, sample_size1 / 2)
lung_cancer_smokers2 <- rep(0, sample_size1 / 2)

# Генерация случаев рака легких для некурящих
lung_cancer_nonsmokers1 <- rep(1, sample_size2 / 2)
lung_cancer_nonsmokers2 <- rep(0, sample_size2 / 2)
```

```{r}
# H0: Нет различия в вероятности заболеть раком легких между курящими и некурящими
# H1: Есть различие в вероятности заболеть раком легких между курящими и некурящими
alpha <- 0.05  
# Используем z-тест для сравнения двух пропорций
# Выполнение z-теста для обеих выборок

result1 <- prop.test(x = c(sum(lung_cancer_smokers1), sum(lung_cancer_nonsmokers1)), n = c(length(lung_cancer_smokers1), length(lung_cancer_nonsmokers1)), correct = FALSE)

result2 <- prop.test(x = c(sum(lung_cancer_smokers2), sum(lung_cancer_nonsmokers2)), n = c(length(lung_cancer_smokers2), length(lung_cancer_nonsmokers2)), correct = FALSE)

result1
result2

```
3. Рассмотрите следующую статистическую гипотезу.

Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией. (исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение)

- Сформулируйте нулевую и альтернативную гипотезы.
- Определите уровень значимости.
- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
- Определите наблюдаемое значение статистики, а также критическое значение статистики.
- Оцените и прокомментируйте статистическую значимость. (3 балла)

```{r}
library("exactRankTests")

# Данные для группы с новым методом лечения
data_treatment <- rnorm(30, mean = 5, sd = 2)

# Данные для группы с диетотерапией
data_control <- rnorm(30, mean = 4, sd = 2)

```

```{r}
# Используем тест Манна-Уитни из-за непараметрической природы данных

alpha <- 0.05

result <- wilcox.test(data_treatment, data_control, alternative = "two.sided", exact = FALSE)

result
```
Наблюдаемое значение статистики (W): 526
Критическое значение статистики для теста Манна-Уитни зависит от размера выборок и не указывается напрямую в выводе теста. Важнее сравнить p-значение с уровнем значимости.

P-значение больше 0.05, что указывает на статистическую незначимость различий между группами. Это означает, что мы не можем отклонить нулевую гипотезу о том, что новый метод лечения не меняет уровень болевых симптомов по сравнению с диетотерапией.



4. Рассмотрите следующую гипотезу.

Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей.
В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.
Сгенерируйте датасет следующим образом:
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)
- Постройте на одном графике три “ящика с усами” для наглядности.
проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах.
- Прокомментируйте получившийся результат.
с помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки.
- Прокомментируйте полученные результаты.

```{r}
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)

```

```{r}
# Построение графиков
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  labs(title = "Размер опухоли в зависимости от терапии", x = "Терапия", y = "Размер опухоли") +
  theme_minimal()
```

```{r}
anova_result <- aov(value ~ therapy, data = tumor)
summary(anova_result)
```

F-значение: 2.519
   P-значение: 0.0993
   Статистическая значимость: Различия между группами не являются статистически значимыми на уровне значимости 0.05.
   Интерпретация: Нельзя отклонить нулевую гипотезу о равенстве средних размеров опухолей между группами терапии A, B и плацебо.
   Вывод: Данные не подтверждают значимое влияние противоопухолевых препаратов A и B по сравнению с плацебо на основе размера опухоли.


```{r}
# Попарные сравнения с использованием критерия Тьюки
tukey_result <- TukeyHSD(anova_result)
tukey_result
```
A vs. 0:
    - Разница в средних: 237.96
    - P-значение: 0.6325
    - Комментарий: Нет статистически значимой разницы в размерах опухолей между группой A и плацебо. P-значение выше уровня значимости 0.05.

B vs. 0:
    - Разница в средних: -339.50
    - P-значение: 0.4005
    - Комментарий: Также нет статистически значимой разницы между группой B и плацебо. P-значение выше 0.05.

B vs. A:
    - Разница в средних: -577.46
    - P-значение: 0.0836
    - Комментарий: Несмотря на то, что разница между препаратами A и B кажется значительной (-577.46), p-значение (0.0836) указывает на отсутствие статистической значимости на стандартном уровне 0.05, но при этом близко к порогу значимости, что может указывать на тенденцию.

Попарные сравнения показывают, что нет статистически значимых различий между группами терапии (A и B) и группой плацебо. Однако, существует некоторая тенденция к различию между препаратами A и B, что потенциально может указывать на разную эффективность препаратов.

Как отправить задание на проверку. Загрузите файлы на GitHub, в форму приложите ссылку на него. Назовите rmd-файл вашим ФИО.
Что нужно отправить: ссылку на репозиторий, который будет содержать RMarkdown-файл с вашим решением.

